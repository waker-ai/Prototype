<!DOCTYPE html>

<html lang="zh-CN">

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <title>项目变更SOP清单 - 管理员功能</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://code.iconify.design/iconify-icon/2.1.0/iconify-icon.min.js"></script>
  <style>
    .hide-scrollbar::-webkit-scrollbar {
      display: none;
    }

    .hide-scrollbar {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .card-transition {
      transition: all 0.3s ease;
    }

    .card-expand {
      animation: fadeIn 0.3s ease forwards;
    }
  </style>
</head>

<body class="bg-gray-50 min-h-screen font-sans">
  <!-- 顶部导航 -->
  <header class="sticky top-0 z-10 bg-white shadow-sm h-20 flex items-center px-8">
    <div class="flex items-center space-x-3">
      <iconify-icon class="text-indigo-700 text-2xl" icon="material-symbols:rocket-launch"></iconify-icon>
      <h1 class="text-2xl font-bold text-gray-900">项目变更SOP清单</h1>
    </div>
    <div class="ml-auto flex items-center space-x-6">
      <div class="relative">
        <input
          class="w-64 px-4 py-2 bg-gray-100 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-600"
          placeholder="搜索变更项目..." type="text" />
        <iconify-icon class="absolute right-3 top-2.5 text-gray-500 text-xl" icon="mdi:magnify"></iconify-icon>
      </div>
      <!-- 新增申请管理按钮 -->
      <button class="flex items-center text-indigo-600 hover:text-indigo-800" id="adminManageBtn">
        <iconify-icon class="mr-1 text-xl" icon="mdi:clipboard-list-outline"></iconify-icon>
        申请管理
      </button>
      <button class="flex items-center text-indigo-600 hover:text-indigo-800" onclick="openSyncChangesModal()">
        <iconify-icon class="mr-1 text-xl" icon="mdi:cloud-sync-outline"></iconify-icon>
        同步变更窗口
      </button>
      <div class="flex items-center space-x-2 py-1">
        <div class="bg-gray-200 border-2 border-dashed rounded-xl w-10 h-10"></div>
        <span class="font-medium text-gray-700">管理员</span>
      </div>
    </div>
  </header>
  <div class="flex p-6">
    <!-- 左侧筛选面板 -->
    <aside class="w-72 bg-white rounded-xl shadow p-5 mr-6 h-fit sticky top-24">
      <h2 class="font-semibold text-gray-800 mb-4">筛选条件</h2>
      <div class="mb-5">
        <h3 class="text-sm font-medium text-gray-700 mb-2">SOP分类</h3>
        <div class="space-y-1">
          <label class="flex items-center">
            <input class="mr-2 h-4 w-4 accent-indigo-600" type="checkbox" />
            <span class="text-gray-600">系统更新</span>
          </label>
          <label class="flex items-center">
            <input class="mr-2 h-4 w-4 accent-indigo-600" type="checkbox" />
            <span class="text-gray-600">配置变更</span>
          </label>
          <label class="flex items-center">
            <input class="mr-2 h-4 w-4 accent-indigo-600" type="checkbox" />
            <span class="text-gray-600">数据迁移</span>
          </label>
        </div>
      </div>
      <div class="mb-5">
        <h3 class="text-sm font-medium text-gray-700 mb-2">状态过滤</h3>
        <div class="grid grid-cols-2 gap-2">
          <button class="py-1 px-3 bg-yellow-100 text-yellow-800 rounded-md text-sm">待处理</button>
          <button class="py-1 px-3 bg-blue-100 text-blue-800 rounded-md text-sm">进行中</button>
          <button class="py-1 px-3 bg-green-100 text-green-800 rounded-md text-sm">已完成</button>
          <button class="py-1 px-3 bg-red-100 text-red-800 rounded-md text-sm">已中止</button>
        </div>
      </div>
      <div class="mb-5">
        <h3 class="text-sm font-medium text-gray-700 mb-2">优先级</h3>
        <div class="space-y-1">
          <label class="flex items-center">
            <input class="mr-2 h-4 w-4 accent-indigo-600" name="priority" type="radio" />
            <span class="text-gray-600">高优先级</span>
          </label>
          <label class="flex items-center">
            <input checked="" class="mr-2 h-4 w-4 accent-indigo-600" name="priority" type="radio" />
            <span class="text-gray-600">中优先级</span>
          </label>
          <label class="flex items-center">
            <input class="mr-2 h-4 w-4 accent-indigo-600" name="priority" type="radio" />
            <span class="text-gray-600">低优先级</span>
          </label>
        </div>
      </div>
      <div>
        <h3 class="text-sm font-medium text-gray-700 mb-2">时间范围</h3>
        <!-- 优化后的时间范围选择器 -->
        <div
          class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 p-1.5 bg-gray-50 rounded-lg border border-gray-200">
          <div class="flex-1 min-w-[100px]">
            <input
              class="w-full px-2 py-1 border border-gray-300 rounded-md focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500 text-xs"
              type="date" />
          </div>
          <span class="text-gray-500 text-xs font-medium sm:mx-1 whitespace-nowrap">至</span>
          <div class="flex-1 min-w-[100px]">
            <input
              class="w-full px-2 py-1 border border-gray-300 rounded-md focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500 text-xs"
              type="date" />
          </div>
        </div>
      </div>
    </aside>
    <!-- 主内容区域：管理员功能标签页 -->
    <main class="flex-1">
      <!-- 标签页导航 -->
      <div class="flex border-b border-gray-200 mb-6">
        <button class="tab-button px-4 py-2 font-medium text-gray-600 hover:text-indigo-700 relative"
          data-tab="applicationList">申请列表</button>
        <button class="tab-button px-4 py-2 font-medium text-gray-600 hover:text-indigo-700 relative"
          data-tab="approvalPage">审批详情</button>
        <button class="tab-button px-4 py-2 font-medium text-gray-600 hover:text-indigo-700 relative"
          data-tab="permissionSetting">权限设置</button>
      </div>
      <!-- 申请列表页面 -->
      <div class="tab-content hidden" id="applicationList">
        <div class="bg-white rounded-xl shadow mb-6">
          <div class="flex items-center justify-between p-5">
            <h2 class="text-xl font-bold text-gray-900">权限申请记录</h2>
            <div class="flex space-x-3">
              <button
                class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 text-sm">导出为Excel</button>
              <button class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 text-sm">刷新数据</button>
            </div>
          </div>
          <div class="px-5 pb-5">
            <div class="flex items-center justify-between mb-4">
              <div class="flex space-x-3">
                <select class="bg-white border border-gray-300 rounded-lg px-4 py-2 text-sm">
                  <option>所有申请人</option>
                  <option>管理员</option>
                  <option>张工</option>
                  <option>李技术</option>
                  <option>王经理</option>
                </select>
                <select class="bg-white border border-gray-300 rounded-lg px-4 py-2 text-sm">
                  <option>所有项目</option>
                  <option>I项目系统</option>
                  <option>慧人天系统</option>
                  <option>分贝通系统</option>
                </select>
                <select class="bg-white border border-gray-300 rounded-lg px-4 py-2 text-sm">
                  <option>所有状态</option>
                  <option>待处理</option>
                  <option>已通过</option>
                  <option>已驳回</option>
                </select>
              </div>
              <div class="relative">
                <input
                  class="w-64 px-4 py-2 bg-gray-50 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-600"
                  placeholder="搜索申请人或项目..." type="text" />
                <iconify-icon class="absolute right-3 top-2.5 text-gray-500" icon="mdi:magnify"></iconify-icon>
              </div>
            </div>
            <div class="overflow-x-auto">
              <table class="w-full">
                <thead>
                  <tr class="bg-gray-50 text-left text-gray-500 text-sm">
                    <th class="px-4 py-3 font-medium">申请人</th>
                    <th class="px-4 py-3 font-medium">申请项目</th>
                    <th class="px-4 py-3 font-medium">申请时间</th>
                    <th class="px-4 py-3 font-medium">状态</th>
                    <th class="px-4 py-3 font-medium">操作</th>
                  </tr>
                </thead>
                <tbody class="text-sm">
                  <tr class="border-b border-gray-200 hover:bg-gray-50 cursor-pointer"
                    onclick="switchToApprovalWithDetails('张工', '更新I项目系统', '待处理')">
                    <td class="px-4 py-3">
                      <div class="flex items-center">
                        <div class="bg-gray-200 border-2 border-dashed rounded-xl w-8 h-8 mr-3"></div>
                        <span>张工</span>
                      </div>
                    </td>
                    <td class="px-4 py-3">更新I项目系统</td>
                    <td class="px-4 py-3">2025-11-24 09:45</td>
                    <td class="px-4 py-3"><span
                        class="px-2 py-1 bg-yellow-100 text-yellow-800 rounded text-xs">待处理</span></td>
                    <td class="px-4 py-3">
                      <button class="text-indigo-600 hover:text-indigo-800 text-sm"
                        onclick="event.stopPropagation(); switchToApprovalWithDetails('张工', '更新I项目系统', '待处理')">审批</button>
                    </td>
                  </tr>
                  <tr class="border-b border-gray-200 hover:bg-gray-50">
                    <td class="px-4 py-3">
                      <div class="flex items-center">
                        <div class="bg-gray-200 border-2 border-dashed rounded-xl w-8 h-8 mr-3"></div>
                        <span>王经理</span>
                      </div>
                    </td>
                    <td class="px-4 py-3">更新慧人天系统</td>
                    <td class="px-4 py-3">2025-11-23 14:20</td>
                    <td class="px-4 py-3"><span class="px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs">进行中</span>
                    </td>
                    <td class="px-4 py-3">
                      <button class="text-indigo-600 hover:text-indigo-800 text-sm"
                        onclick="switchToApproval()">查看</button>
                    </td>
                  </tr>
                  <tr class="border-b border-gray-200 hover:bg-gray-50">
                    <td class="px-4 py-3">
                      <div class="flex items-center">
                        <div class="bg-gray-200 border-2 border-dashed rounded-xl w-8 h-8 mr-3"></div>
                        <span>李技术</span>
                      </div>
                    </td>
                    <td class="px-4 py-3">更新分贝通系统</td>
                    <td class="px-4 py-3">2025-11-22 16:30</td>
                    <td class="px-4 py-3"><span class="px-2 py-1 bg-green-100 text-green-800 rounded text-xs">已完成</span>
                    </td>
                    <td class="px-4 py-3">
                      <button class="text-indigo-600 hover:text-indigo-800 text-sm"
                        onclick="switchToApproval()">查看</button>
                    </td>
                  </tr>
                  <tr class="border-b border-gray-200 hover:bg-gray-50">
                    <td class="px-4 py-3">
                      <div class="flex items-center">
                        <div class="bg-gray-200 border-2 border-dashed rounded-xl w-8 h-8 mr-3"></div>
                        <span>管理员</span>
                      </div>
                    </td>
                    <td class="px-4 py-3">修改企业微信群</td>
                    <td class="px-4 py-3">2025-11-21 11:15</td>
                    <td class="px-4 py-3"><span class="px-2 py-1 bg-red-100 text-red-800 rounded text-xs">已驳回</span>
                    </td>
                    <td class="px-4 py-3">
                      <button class="text-indigo-600 hover:text-indigo-800 text-sm"
                        onclick="switchToApproval()">查看</button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <!-- 审批详情页面 -->
      <div class="tab-content hidden" id="approvalPage">
        <div class="flex gap-6">
          <div class="w-2/3 bg-white rounded-xl shadow">
            <div class="p-5 border-b border-gray-200">
              <h2 class="text-xl font-bold text-gray-900">申请详情</h2>
            </div>
            <div class="p-5 space-y-6">
              <div>
                <h3 class="text-sm font-medium text-gray-500 mb-2">申请人</h3>
                <div class="flex items-center">
                  <div class="bg-gray-200 border-2 border-dashed rounded-xl w-12 h-12 mr-4"></div>
                  <div>
                    <p class="font-medium">张工</p>
                    <p class="text-sm text-gray-600">技术部</p>
                  </div>
                </div>
              </div>
              <div>
                <h3 class="text-sm font-medium text-gray-500 mb-2">申请项目</h3>
                <p class="font-medium">更新I项目系统</p>
                <p class="text-gray-600 mt-2">更新项目管理系统至最新版本，包括数据库迁移和接口配置</p>
              </div>
              <div>
                <h3 class="text-sm font-medium text-gray-500 mb-2">申请原因</h3>
                <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                  <p class="text-gray-700">由于系统老旧导致性能瓶颈，需升级到最新版本以支持更大规模的数据处理能力。升级后将优化查询速度50%，减少系统故障率，并兼容新增的外部接口需求。</p>
                </div>
              </div>
              <div>
                <h3 class="text-sm font-medium text-gray-500 mb-2">相关附件</h3>
                <div class="flex items-center p-3 border border-gray-200 rounded-lg">
                  <iconify-icon class="text-blue-500 text-2xl mr-3" icon="mdi:file-document-outline"></iconify-icon>
                  <div>
                    <p class="text-sm font-medium">系统升级方案_V1.2.pdf</p>
                    <p class="text-xs text-gray-500">3.2MB</p>
                  </div>
                  <button class="ml-auto text-indigo-600 text-sm font-medium">预览</button>
                </div>
              </div>
            </div>
          </div>
          <div class="flex-1 bg-white rounded-xl shadow">
            <div class="p-5 border-b border-gray-200">
              <h2 class="text-xl font-bold text-gray-900">审批操作</h2>
            </div>
            <div class="p-5 space-y-5">
              <div>
                <h3 class="text-sm font-medium text-gray-500 mb-3">审批状态</h3>
                <div class="flex items-center justify-between mb-4">
                  <span class="px-3 py-1 bg-yellow-100 text-yellow-800 rounded-full text-sm font-medium">待处理</span>
                  <p class="text-sm text-gray-500">申请时间: 2025-11-24 09:45</p>
                </div>
                <div class="border-l-2 border-gray-200 ml-4 pl-4 space-y-4 py-2">
                  <div>
                    <div class="flex items-center">
                      <div class="w-4 h-4 rounded-full bg-indigo-600 -ml-[15px]"></div>
                      <p class="ml-2 text-sm font-medium">申请提交</p>
                    </div>
                    <p class="text-xs text-gray-500 mt-1 ml-6">2025-11-24 09:45</p>
                  </div>
                  <div class="opacity-50">
                    <div class="flex items-center">
                      <div class="w-4 h-4 rounded-full bg-gray-200 -ml-[15px] border-2 border-gray-300"></div>
                      <p class="ml-2 text-sm font-medium">负责人审批</p>
                    </div>
                  </div>
                  <div class="opacity-50">
                    <div class="flex items-center">
                      <div class="w-4 h-4 rounded-full bg-gray-200 -ml-[15px] border-2 border-gray-300"></div>
                      <p class="ml-2 text-sm font-medium">技术审核</p>
                    </div>
                  </div>
                  <div class="opacity-50">
                    <div class="flex items-center">
                      <div class="w-4 h-4 rounded-full bg-gray-200 -ml-[15px] border-2 border-gray-300"></div>
                      <p class="ml-2 text-sm font-medium">完成执行</p>
                    </div>
                  </div>
                </div>
              </div>
              <div>
                <h3 class="text-sm font-medium text-gray-500 mb-2">审批意见 <span class="text-red-500">*</span></h3>
                <textarea
                  class="w-full px-3 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm resize-none"
                  placeholder="请输入审批意见（至少20字）" rows="3"></textarea>
                <p class="text-xs text-gray-500 mt-1">0/200 字</p>
              </div>
              <div class="flex gap-3">
                <button
                  class="flex-1 px-4 py-3 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 font-medium">驳回</button>
                <button
                  class="flex-1 px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium">通过</button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- 项目权限设置页面 -->
      <div class="tab-content hidden" id="permissionSetting">
        <div class="flex gap-6">
          <div class="w-1/3 bg-white rounded-xl shadow">
            <div class="p-5 border-b border-gray-200">
              <div class="flex justify-between items-center">
                <h2 class="font-bold text-gray-900">项目列表</h2>
                <button class="text-sm text-blue-600 font-medium">新建项目</button>
              </div>
            </div>
            <div class="p-3">
              <div class="relative">
                <input
                  class="w-full px-4 py-2 bg-gray-50 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-600"
                  placeholder="搜索项目..." type="text" />
                <iconify-icon class="absolute right-3 top-2.5 text-gray-500" icon="mdi:magnify"></iconify-icon>
              </div>
              <div class="mt-4 space-y-2">
                <div class="group flex items-center justify-between p-3 rounded-lg hover:bg-blue-50 cursor-pointer">
                  <div>
                    <p class="font-medium">I项目系统</p>
                    <p class="text-xs text-gray-500">技术部</p>
                  </div>
                  <iconify-icon class="text-gray-400 group-hover:text-blue-600" icon="mdi:chevron-right"></iconify-icon>
                </div>
                <div class="group flex items-center justify-between p-3 rounded-lg hover:bg-blue-50 cursor-pointer">
                  <div>
                    <p class="font-medium">慧人天系统</p>
                    <p class="text-xs text-gray-500">人力资源部</p>
                  </div>
                  <iconify-icon class="text-gray-400 group-hover:text-blue-600" icon="mdi:chevron-right"></iconify-icon>
                </div>
                <div class="group flex items-center justify-between p-3 rounded-lg hover:bg-blue-50 cursor-pointer">
                  <div>
                    <p class="font-medium">分贝通系统</p>
                    <p class="text-xs text-gray-500">财务部</p>
                  </div>
                  <iconify-icon class="text-gray-400 group-hover:text-blue-600" icon="mdi:chevron-right"></iconify-icon>
                </div>
                <div class="group flex items-center justify-between p-3 rounded-lg hover:bg-blue-50 cursor-pointer">
                  <div>
                    <p class="font-medium">企业微信管理</p>
                    <p class="text-xs text-gray-500">行政部</p>
                  </div>
                  <iconify-icon class="text-gray-400 group-hover:text-blue-600" icon="mdi:chevron-right"></iconify-icon>
                </div>
              </div>
            </div>
          </div>
          <div class="flex-1 bg-white rounded-xl shadow">
            <div class="p-5 border-b border-gray-200">
              <h2 class="font-bold text-gray-900">项目权限设置</h2>
            </div>
            <div class="p-5 space-y-6">
              <div>
                <h3 class="font-medium text-gray-900 mb-3">项目成员管理</h3>
                <div class="bg-gray-50 rounded-lg p-4">
                  <div class="flex items-center justify-between mb-4">
                    <p class="text-sm font-medium text-gray-700">成员列表</p>
                    <button class="text-blue-600 text-sm font-medium">添加成员</button>
                  </div>
                  <div class="flex flex-wrap gap-3">
                    <div class="flex items-center bg-white px-3 py-2 rounded-lg border border-gray-200">
                      <div class="bg-gray-200 border-2 border-dashed rounded-xl w-8 h-8 mr-2"></div>
                      <span class="mr-2">张工</span>
                      <span class="text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded">管理员</span>
                    </div>
                    <div class="flex items-center bg-white px-3 py-2 rounded-lg border border-gray-200">
                      <div class="bg-gray-200 border-2 border-dashed rounded-xl w-8 h-8 mr-2"></div>
                      <span class="mr-2">李技术</span>
                      <span class="text-xs bg-green-100 text-green-800 px-2 py-0.5 rounded">编辑者</span>
                    </div>
                    <div class="flex items-center bg-white px-3 py-2 rounded-lg border border-gray-200">
                      <div class="bg-gray-200 border-2 border-dashed rounded-xl w-8 h-8 mr-2"></div>
                      <span class="mr-2">王经理</span>
                      <span class="text-xs bg-green-100 text-green-800 px-2 py-0.5 rounded">编辑者</span>
                    </div>
                  </div>
                </div>
              </div>
              <div>
                <h3 class="font-medium text-gray-900 mb-3">权限角色配置</h3>
                <div class="overflow-x-auto">
                  <table class="w-full text-sm">
                    <thead>
                      <tr class="bg-gray-100 text-left text-gray-700">
                        <th class="px-4 py-3">功能权限</th>
                        <th class="px-4 py-3">管理员</th>
                        <th class="px-4 py-3">编辑者</th>
                        <th class="px-4 py-3">查看者</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr class="border-b border-gray-200 hover:bg-gray-50">
                        <td class="px-4 py-3">编辑项目信息</td>
                        <td class="px-4 py-3">
                          <iconify-icon class="text-green-500 text-xl" icon="mdi:check-circle"></iconify-icon>
                        </td>
                        <td class="px-4 py-3">
                          <iconify-icon class="text-green-500 text-xl" icon="mdi:check-circle"></iconify-icon>
                        </td>
                        <td class="px-4 py-3">
                          <iconify-icon class="text-gray-300 text-xl" icon="mdi:close-circle"></iconify-icon>
                        </td>
                      </tr>
                      <tr class="border-b border-gray-200 hover:bg-gray-50">
                        <td class="px-4 py-3">变更SOP流程</td>
                        <td class="px-4 py-3">
                          <iconify-icon class="text-green-500 text-xl" icon="mdi:check-circle"></iconify-icon>
                        </td>
                        <td class="px-4 py-3">
                          <iconify-icon class="text-green-500 text-xl" icon="mdi:check-circle"></iconify-icon>
                        </td>
                        <td class="px-4 py-3">
                          <iconify-icon class="text-gray-300 text-xl" icon="mdi:close-circle"></iconify-icon>
                        </td>
                      </tr>
                      <tr class="border-b border-gray-200 hover:bg-gray-50">
                        <td class="px-4 py-3">审批变更请求</td>
                        <td class="px-4 py-3">
                          <iconify-icon class="text-green-500 text-xl" icon="mdi:check-circle"></iconify-icon>
                        </td>
                        <td class="px-4 py-3">
                          <iconify-icon class="text-gray-300 text-xl" icon="mdi:close-circle"></iconify-icon>
                        </td>
                        <td class="px-4 py-3">
                          <iconify-icon class="text-gray-300 text-xl" icon="mdi:close-circle"></iconify-icon>
                        </td>
                      </tr>
                      <tr class="border-b border-gray-200 hover:bg-gray-50">
                        <td class="px-4 py-3">删除项目</td>
                        <td class="px-4 py-3">
                          <iconify-icon class="text-green-500 text-xl" icon="mdi:check-circle"></iconify-icon>
                        </td>
                        <td class="px-4 py-3">
                          <iconify-icon class="text-gray-300 text-xl" icon="mdi:close-circle"></iconify-icon>
                        </td>
                        <td class="px-4 py-3">
                          <iconify-icon class="text-gray-300 text-xl" icon="mdi:close-circle"></iconify-icon>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
              <div>
                <h3 class="font-medium text-gray-900 mb-3">变更历史</h3>
                <div class="bg-gray-50 rounded-lg p-4">
                  <div class="flex justify-between items-center border-b border-gray-200 pb-3 mb-3">
                    <p class="text-sm font-medium">2025-11-24</p>
                    <p class="text-xs text-gray-500">管理员操作</p>
                  </div>
                  <div class="text-sm">
                    <p class="mb-1">编辑了成员权限：将李技术的角色从"查看者"改为"编辑者"</p>
                    <p class="text-gray-600">增加了编辑者角色对SOP流程的变更权限</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>
  <!-- 上传模态框 -->
  <div class="fixed inset-0 bg-black bg-opacity-50 z-20 hidden items-center justify-center" id="uploadModal">
    <div class="bg-white rounded-xl shadow-xl w-96 p-6">
      <div class="flex justify-between items-center mb-4">
        <h3 class="font-semibold text-gray-900">上传变更文档</h3>
        <button class="text-gray-500 hover:text-gray-700" onclick="closeUploadModal()">
          <iconify-icon class="text-xl" icon="mdi:close"></iconify-icon>
        </button>
      </div>
      <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center mb-4">
        <iconify-icon class="text-4xl text-indigo-600 mb-2" icon="mdi:file-upload"></iconify-icon>
        <p class="text-gray-600 mb-2">拖放文件或点击上传</p>
        <p class="text-xs text-gray-500">支持PDF, DOCX, XLSX格式，最大5MB</p>
      </div>
      <div class="flex justify-between">
        <button class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50"
          onclick="closeUploadModal()">取消</button>
        <button class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">确认上传</button>
      </div>
    </div>
  </div>
  <!-- 同步变更窗口弹窗 -->
  <div class="fixed inset-0 bg-black bg-opacity-50 z-20 hidden items-center justify-center" id="syncChangesModal">
    <div class="bg-white rounded-xl shadow-xl w-4/5 max-w-5xl p-6 max-h-[90vh] flex flex-col">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-xl font-bold text-gray-900 flex items-center">
          <iconify-icon class="text-indigo-600 mr-2 text-2xl" icon="mdi:cloud-sync"></iconify-icon>
          同步变更窗口
        </h2>
        <button class="text-gray-500 hover:text-gray-700" onclick="closeSyncChangesModal()">
          <iconify-icon class="text-xl" icon="mdi:close"></iconify-icon>
        </button>
      </div>
      <div class="flex-1 overflow-y-auto max-h-[70vh] border border-gray-200 rounded-lg">
        <table class="w-full text-left">
          <thead class="bg-gray-50 sticky top-0">
            <tr>
              <th class="px-6 py-3 font-medium text-gray-500 text-sm border-b">文件名</th>
              <th class="px-6 py-3 font-medium text-gray-500 text-sm border-b">上传者</th>
              <th class="px-6 py-3 font-medium text-gray-500 text-sm border-b">上传时间</th>
              <th class="px-6 py-3 font-medium text-gray-500 text-sm border-b">关联项目</th>
              <th class="px-6 py-3 font-medium text-gray-500 text-sm border-b">文件大小</th>
              <th class="px-6 py-3 font-medium text-gray-500 text-sm border-b">操作</th>
            </tr>
          </thead>
          <tbody id="syncChangesList">
            <!-- 数据通过JS动态生成 -->
          </tbody>
        </table>
      </div>
      <div class="mt-6 flex justify-between items-center">
        <div class="text-sm text-gray-500">
          共 <span id="changesCount">0</span> 个变更记录
        </div>
        <div class="flex gap-2">
          <button class="px-4 py-2 border border-indigo-600 text-indigo-600 rounded-lg hover:bg-indigo-50">
            导出为报表
          </button>
          <button class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">
            清空记录
          </button>
        </div>
      </div>
    </div>
  </div>
  <!-- 权限申请弹窗 -->
  <div class="fixed inset-0 bg-black bg-opacity-50 z-20 hidden flex items-center justify-center" id="permissionModal">
    <div class="bg-white rounded-xl shadow-xl w-96 p-6 border border-gray-200">
      <div class="flex justify-between items-center mb-6">
        <h3 class="font-bold text-lg text-gray-900">权限申请表</h3>
        <button class="text-gray-500 hover:text-gray-700" onclick="closePermissionModal()">
          <iconify-icon class="text-xl" icon="mdi:close"></iconify-icon>
        </button>
      </div>
      <div class="space-y-4 max-h-96 overflow-y-auto">
        <!-- 申请人信息 -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">申请人</label>
          <div class="bg-gray-50 border border-gray-300 rounded-lg px-3 py-2.5">
            <p class="text-gray-900">管理员</p>
            <p class="text-xs text-gray-600">技术部</p>
          </div>
        </div>
        <!-- 申请原因 -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">申请原因 <span class="text-red-500">*</span></label>
          <textarea
            class="w-full px-3 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm resize-none"
            id="applyReason" maxlength="500" minlength="50" placeholder="请输入申请原因（至少50字）" rows="3"></textarea>
          <p class="text-xs text-gray-500 mt-1"><span id="charCount">0</span>/500 字</p>
        </div>
        <!-- 申请时间 -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">申请时间 <span class="text-red-500">*</span></label>
          <input
            class="w-full px-3 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"
            id="applyDateTime" type="datetime-local">
          </input>
        </div>
        <!-- 权限说明 -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">权限说明</label>
          <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
            <p class="text-sm text-gray-700" id="permissionDesc">权限描述加载中...</p>
          </div>
        </div>
        <!-- 状态显示 -->
        <div class="hidden bg-yellow-50 border border-yellow-200 rounded-lg p-3" id="statusDisplay">
          <div class="flex items-center justify-between mb-2">
            <span class="text-sm font-medium text-gray-700">申请状态</span>
            <span class="px-3 py-1 bg-yellow-100 text-yellow-800 rounded text-xs font-medium"
              id="statusBadge">待处理</span>
          </div>
          <p class="text-xs text-gray-600" id="statusTime">提交时间: 2025-11-24</p>
        </div>
      </div>
      <!-- 底部按钮 -->
      <div class="flex gap-3 mt-6">
        <button
          class="flex-1 px-4 py-2.5 border border-blue-600 text-blue-600 rounded-lg hover:bg-blue-50 font-medium text-sm"
          onclick="closePermissionModal()">取消</button>
        <button class="flex-1 px-4 py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium text-sm"
          onclick="submitPermissionRequest()">提交申请</button>
      </div>
    </div>
  </div>
  <script>
    // 卡片展开/收起功能
    function toggleExpand(id) {
      const expandContent = document.getElementById(`expand-${id}`);
      expandContent.classList.toggle('hidden');
      expandContent.classList.toggle('card-expand');
    }

    // 状态切换功能
    function toggleStatus(id) {
      const button = document.querySelectorAll('.toggle-button')[id - 1];
      const icon = button.querySelector('iconify-icon');
      const statusBar = button.closest('.card-transition').querySelector('.w-1');

      button.classList.toggle('bg-indigo-600');
      button.classList.toggle('border-indigo-600');
      icon.classList.toggle('hidden');

      if (button.classList.contains('bg-indigo-600')) {
        statusBar.classList.remove('bg-yellow-500', 'bg-blue-500', 'bg-red-500');
        statusBar.classList.add('bg-green-500');
      } else {
        statusBar.classList.remove('bg-green-500');
        statusBar.classList.add('bg-yellow-500');
      }
    }

    // 在DOMContentLoaded事件监听器内添加
    // 存储当前选中的申请详情
    let currentApplication = null;

    // 带参数的审批跳转函数
    function switchToApprovalWithDetails(applicant, project, status) {
      // 存储当前申请详情
      currentApplication = {
        applicant: applicant,
        project: project,
        status: status,
        timestamp: new Date().toLocaleString('zh-CN')
      };

      // 更新审批页面内容
      updateApprovalPage();

      // 切换到审批页面
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.add('hidden');
      });
      document.getElementById('approvalPage').classList.remove('hidden');

      // 更新标签页状态
      document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('text-indigo-700', 'border-b-2', 'border-indigo-600');
      });
      document.querySelector('.tab-button[data-tab="approvalPage"]').classList.add('text-indigo-700', 'border-b-2', 'border-indigo-600');
    }

    // 更新审批页面内容的函数
    function updateApprovalPage() {
      if (!currentApplication) return;

      // 更新申请人信息
      const applicantElements = document.querySelectorAll('#approvalPage .font-medium');
      if (applicantElements[0]) {
        applicantElements[0].textContent = currentApplication.applicant;
        if (currentApplication.applicant === '张工') {
          applicantElements[1].textContent = '技术部';
        } else if (currentApplication.applicant === '王经理') {
          applicantElements[1].textContent = '项目部';
        } else if (currentApplication.applicant === '李技术') {
          applicantElements[1].textContent = '技术部';
        } else {
          applicantElements[1].textContent = '管理部门';
        }
      }

      // 更新申请项目
      const projectElements = document.querySelectorAll('#approvalPage .font-medium');
      if (projectElements[1]) {
        projectElements[1].textContent = currentApplication.project;
      }

      // 更新申请原因（根据项目类型设置不同的原因）
      let reasonText = '';
      if (currentApplication.project.includes('I项目系统')) {
        reasonText = '由于系统老旧导致性能瓶颈，需升级到最新版本以支持更大规模的数据处理能力。升级后将优化查询速度50%，减少系统故障率，并兼容新增的外部接口需求。';
      } else if (currentApplication.project.includes('慧人天系统')) {
        reasonText = '为了满足人力资源管理的新需求，需要更新系统功能，包括员工档案管理、考勤系统和绩效评估模块的优化。';
      } else if (currentApplication.project.includes('分贝通系统')) {
        reasonText = '财务系统需要更新以支持新的支付渠道和报销流程，确保与最新财税政策保持一致。';
      } else {
        reasonText = '企业微信群需要更换管理员，以确保工作沟通的连续性和信息安全性。';
      }

      const reasonElement = document.querySelector('#approvalPage .text-gray-700');
      if (reasonElement) {
        reasonElement.textContent = reasonText;
      }

      // 更新状态显示
      const statusBadge = document.querySelector('#approvalPage .bg-yellow-100, #approvalPage .bg-blue-100, #approvalPage .bg-green-100, #approvalPage .bg-red-100');
      if (statusBadge) {
        // 移除所有状态类
        statusBadge.className = 'px-3 py-1 rounded-full text-sm font-medium';

        // 添加新状态类
        if (currentApplication.status === '待处理') {
          statusBadge.classList.add('bg-yellow-100', 'text-yellow-800');
        } else if (currentApplication.status === '进行中') {
          statusBadge.classList.add('bg-blue-100', 'text-blue-800');
        } else if (currentApplication.status === '已完成') {
          statusBadge.classList.add('bg-green-100', 'text-green-800');
        } else if (currentApplication.status === '已驳回') {
          statusBadge.classList.add('bg-red-100', 'text-red-800');
        }
        statusBadge.textContent = currentApplication.status;
      }

      // 更新申请时间
      const timeElement = document.querySelector('#approvalPage .text-gray-500');
      if (timeElement && timeElement.textContent.includes('申请时间')) {
        timeElement.textContent = `申请时间: ${currentApplication.timestamp}`;
      }

      // 更新审批操作区域
      const approvalStatus = document.querySelector('#approvalPage .font-medium');
      if (approvalStatus && approvalStatus.textContent === '待处理') {
        approvalStatus.textContent = currentApplication.status;
      }
    }

    // 上传模态框控制
    let currentCardId = 0;

    function openUploadModal(id) {
      currentCardId = id;
      document.getElementById('uploadModal').classList.remove('hidden');
      document.getElementById('uploadModal').classList.add('flex');
    }

    function closeUploadModal() {
      document.getElementById('uploadModal').classList.add('hidden');
      document.getElementById('uploadModal').classList.remove('flex');
    }

    // 同步变更窗口控制
    function openSyncChangesModal() {
      // 生成示例的变更记录数据
      const changeRecords = [
        { id: 1, filename: '系统升级方案.pdf', uploader: '张工', uploadTime: '2025-11-23 14:35', project: 'I项目系统', size: '2.4MB' },
        { id: 2, filename: '数据迁移计划.xlsx', uploader: '李技术', uploadTime: '2025-11-22 10:20', project: '分贝通系统', size: '1.2MB' },
        { id: 3, filename: '权限配置更新.doc', uploader: '王经理', uploadTime: '2025-11-21 16:45', project: '慧人天系统', size: '0.8MB' },
        { id: 4, filename: '群主交接确认.png', uploader: '管理员', uploadTime: '2025-11-20 09:15', project: '企业微信群', size: '0.5MB' },
        { id: 5, filename: '周报格式调整.docx', uploader: '助理', uploadTime: '2025-11-19 13:30', project: '周报总表', size: '0.7MB' },
        { id: 6, filename: '财务预算模板.xlsx', uploader: '财务部', uploadTime: '2025-11-18 11:05', project: '财务跟踪表', size: '1.1MB' },
        { id: 7, filename: '变更审核记录.pdf', uploader: '质量组', uploadTime: '2025-11-17 15:40', project: 'I项目系统', size: '1.8MB' }
      ];

      // 渲染变更记录列表
      const listEl = document.getElementById('syncChangesList');
      listEl.innerHTML = '';

      changeRecords.forEach(record => {
        const tr = document.createElement('tr');
        tr.className = 'hover:bg-gray-50';
        tr.innerHTML = `
          <td class="px-6 py-4 border-b">
            <div class="flex items-center">
              <iconify-icon icon="mdi:file-document" class="text-blue-500 text-xl mr-3"></iconify-icon>
              ${record.filename}
            </div>
          </td>
          <td class="px-6 py-4 border-b">
            <div class="flex items-center">
              <div class="bg-gray-200 border-2 border-dashed rounded-full w-7 h-7 mr-2"></div>
              ${record.uploader}
            </div>
          </td>
          <td class="px-6 py-4 border-b text-gray-600 text-sm">${record.uploadTime}</td>
          <td class="px-6 py-4 border-b">
            <span class="px-2 py-1 bg-indigo-100 text-indigo-700 rounded text-xs">${record.project}</span>
          </td>
          <td class="px-6 py-4 border-b text-gray-500 text-sm">${record.size}</td>
          <td class="px-6 py-4 border-b">
            <button class="text-indigo-600 hover:text-indigo-800" onclick="downloadFile(${record.id})">
              <iconify-icon icon="mdi:download" class="text-lg"></iconify-icon>
            </button>
          </td>
        `;
        listEl.appendChild(tr);
      });

      // 更新总数
      document.getElementById('changesCount').textContent = changeRecords.length;

      // 显示模态框
      document.getElementById('syncChangesModal').classList.remove('hidden');
      document.getElementById('syncChangesModal').classList.add('flex');
    }

    function closeSyncChangesModal() {
      document.getElementById('syncChangesModal').classList.add('hidden');
      document.getElementById('syncChangesModal').classList.remove('flex');
    }

    // 权限申请弹窗控制
    let permissionRequests = {};
    let currentPermissionRequest = null;

    function openPermissionModal(id, title, description) {
      currentPermissionRequest = {
        id: id,
        title: title,
        description: description,
        status: 'draft'
      };

      // 设置权限说明
      document.getElementById('permissionDesc').textContent = description;

      // 设置默认时间为当前时间
      const now = new Date();
      now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
      document.getElementById('applyDateTime').value = now.toISOString().slice(0, 16);

      // 清空申请原因
      document.getElementById('applyReason').value = '';
      document.getElementById('charCount').textContent = '0';

      // 隐藏状态显示
      document.getElementById('statusDisplay').classList.add('hidden');

      document.getElementById('permissionModal').classList.remove('hidden');
      document.getElementById('permissionModal').classList.add('flex');
    }

    function closePermissionModal() {
      currentPermissionRequest = null;
      document.getElementById('permissionModal').classList.add('hidden');
      document.getElementById('permissionModal').classList.remove('flex');
    }

    function submitPermissionRequest() {
      const reason = document.getElementById('applyReason').value.trim();
      const dateTime = document.getElementById('applyDateTime').value;

      if (!reason || reason.length < 50) {
        alert('请输入至少50个字的申请原因');
        return;
      }

      if (!dateTime) {
        alert('请选择申请时间');
        return;
      }

      // 保存申请信息
      permissionRequests[currentPermissionRequest.id] = {
        ...currentPermissionRequest,
        reason: reason,
        dateTime: dateTime,
        status: 'pending',
        submitTime: new Date().toLocaleString('zh-CN')
      };

      // 显示待审批状态
      document.getElementById('statusDisplay').classList.remove('hidden');
      document.getElementById('statusBadge').textContent = '等待审批';
      document.getElementById('statusBadge').className = 'px-3 py-1 bg-blue-100 text-blue-800 rounded text-xs font-medium';
      document.getElementById('statusTime').textContent = '提交时间: ' + new Date().toLocaleString('zh-CN');

      // 禁用表单输入
      document.getElementById('applyReason').disabled = true;
      document.getElementById('applyDateTime').disabled = true;
      document.querySelectorAll('#permissionModal button').forEach(btn => {
        if (btn.textContent.includes('提交申请')) {
          btn.disabled = true;
          btn.classList.add('opacity-50', 'cursor-not-allowed');
        }
      });

      setTimeout(() => {
        alert('权限申请已提交，等待审批中...');
      }, 300);
    }

    // 标签页切换功能
    function switchToApproval() {
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.add('hidden');
      });
      document.getElementById('approvalPage').classList.remove('hidden');
    }

    document.addEventListener('DOMContentLoaded', () => {
      // 绑定标签页切换事件
      document.querySelectorAll('.tab-button').forEach(button => {
        button.addEventListener('click', () => {
          const tabId = button.getAttribute('data-tab');

          // 隐藏所有标签内容
          document.querySelectorAll('.tab-content').forEach(tab => {
            tab.classList.add('hidden');
          });

          // 显示选中标签内容
          document.getElementById(tabId).classList.remove('hidden');

          // 更新选中状态
          document.querySelectorAll('.tab-button').forEach(btn => {
            btn.classList.remove('text-indigo-700', 'border-b-2', 'border-indigo-600');
          });
          button.classList.add('text-indigo-700', 'border-b-2', 'border-indigo-600');
        });
      });

      // 默认激活第一个标签
      const firstTab = document.querySelector('.tab-button');
      if (firstTab) {
        firstTab.click();
      }

      // 申请管理按钮打开申请列表
      document.getElementById('adminManageBtn').addEventListener('click', function () {
        document.querySelector('.tab-button[data-tab="applicationList"]').click();
      });

      // 绑定申请原因字数统计
      const reasonTextarea = document.getElementById('applyReason');
      if (reasonTextarea) {
        reasonTextarea.addEventListener('input', () => {
          document.getElementById('charCount').textContent = reasonTextarea.value.length;
        });
      }

      // 设置已完成状态的卡片
      toggleStatus(3);
    });

    // 下载文件函数
    function downloadFile(id) {
      alert(`正在下载文件(ID: ${id})...`);
    }
  </script>
</body>

</html>