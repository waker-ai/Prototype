<!DOCTYPE html>

<html lang="zh-CN">

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <title>项目变更SOP清单</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://code.iconify.design/iconify-icon/2.1.0/iconify-icon.min.js"></script>
  <style>
    .hide-scrollbar::-webkit-scrollbar {
      display: none;
    }

    .hide-scrollbar {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .card-transition {
      transition: all 0.3s ease;
    }

    .card-expand {
      animation: fadeIn 0.3s ease forwards;
    }
  </style>
</head>

<body class="bg-gray-50 min-h-screen font-sans">
  <!-- 顶部导航 -->
  <header class="sticky top-0 z-10 bg-white shadow-sm h-20 flex items-center px-8 border-b-4 border-blue-600">
    <div class="flex items-center space-x-3">
      <iconify-icon class="text-blue-600 text-2xl" icon="material-symbols:rocket-launch"></iconify-icon>
      <h1 class="text-2xl font-bold text-black">项目变更SOP清单</h1>
    </div>
    <div class="ml-auto flex items-center space-x-6">
      <div class="relative">
        <input
          class="w-64 px-4 py-2 bg-white rounded-none border-3 border-blue-600 focus:outline-none focus:ring-2 focus:ring-yellow-400"
          placeholder="搜索变更项目..." type="text" />
        <iconify-icon class="absolute right-3 top-2.5 text-blue-600 text-xl" icon="mdi:magnify"></iconify-icon>
      </div>
      <button class="flex items-center text-blue-600 hover:text-blue-800 font-black" onclick="openSyncChangesModal()">
        <iconify-icon class="mr-1 text-xl" icon="mdi:cloud-sync-outline"></iconify-icon>
        同步变更窗口
      </button>
      <div class="flex items-center space-x-2 py-1">
        <div class="bg-blue-600 border-2 border-dashed rounded-none w-10 h-10"></div>
        <span class="font-black text-blue-600">管理员</span>
      </div>
    </div>
  </header>
  <div class="flex p-6">
    <!-- 左侧筛选面板 -->
    <aside class="w-72 bg-white border-4 border-blue-600 shadow p-5 mr-6 h-fit sticky top-24">
      <h2 class="font-black text-blue-600 mb-4 text-lg">筛选条件</h2>
      <div class="mb-5">
        <h3 class="text-sm font-black text-blue-600 mb-2">SOP分类</h3>
        <div class="space-y-1">
          <label class="flex items-center">
            <input class="mr-2 h-4 w-4 accent-blue-600" type="checkbox" />
            <span class="text-blue-600 font-medium">系统更新</span>
          </label>
          <label class="flex items-center">
            <input class="mr-2 h-4 w-4 accent-blue-600" type="checkbox" />
            <span class="text-blue-600 font-medium">配置变更</span>
          </label>
          <label class="flex items-center">
            <input class="mr-2 h-4 w-4 accent-blue-600" type="checkbox" />
            <span class="text-blue-600 font-medium">数据迁移</span>
          </label>
        </div>
      </div>
      <div class="mb-5">
        <h3 class="text-sm font-black text-blue-600 mb-2">状态过滤</h3>
        <div class="grid grid-cols-2 gap-2">
          <button class="py-1 px-3 bg-red-600 text-yellow-400 rounded-none text-sm font-black border-2 border-red-600">待处理</button>
          <button class="py-1 px-3 bg-yellow-400 text-blue-600 rounded-none text-sm font-black border-2 border-yellow-400">进行中</button>
          <button class="py-1 px-3 bg-green-500 text-white rounded-none text-sm font-black border-2 border-green-500">已完成</button>
          <button class="py-1 px-3 bg-gray-500 text-white rounded-none text-sm font-black border-2 border-gray-500">已中止</button>
        </div>
      </div>
      <div class="mb-5">
        <h3 class="text-sm font-black text-blue-600 mb-2">优先级</h3>
        <div class="space-y-1">
          <label class="flex items-center">
            <input class="mr-2 h-4 w-4 accent-blue-600" name="priority" type="radio" />
            <span class="text-pink-400 font-medium">高优先级</span>
          </label>
          <label class="flex items-center">
            <input checked="" class="mr-2 h-4 w-4 accent-blue-600" name="priority" type="radio" />
            <span class="text-yellow-500 font-medium">中优先级</span>
          </label>
          <label class="flex items-center">
            <input class="mr-2 h-4 w-4 accent-blue-600" name="priority" type="radio" />
            <span class="text-green-600 font-medium">低优先级</span>
          </label>
        </div>
      </div>
      <div>
        <h3 class="text-sm font-black text-blue-600 mb-2">时间范围</h3>
        <div
          class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 p-1.5 bg-white border-3 border-blue-600 rounded-none">
          <div class="flex-1 min-w-[100px]">
            <input
              class="w-full px-2 py-1 border-3 border-blue-600 rounded-none focus:ring-1 focus:ring-yellow-400 focus:border-yellow-400 text-xs font-bold"
              type="date" />
          </div>
          <span class="text-blue-600 text-xs font-black sm:mx-1 whitespace-nowrap">至</span>
          <div class="flex-1 min-w-[100px]">
            <input
              class="w-full px-2 py-1 border-3 border-blue-600 rounded-none focus:ring-1 focus:ring-yellow-400 focus:border-yellow-400 text-xs font-bold"
              type="date" />
          </div>
        </div>
      </div>
    </aside>
    <!-- 主内容区域 -->
    <main class="flex-1">
      <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6">
        <!-- SOP项目卡片 1 -->
        <div class="bg-white border-4 border-blue-600 shadow-md overflow-hidden card-transition">
          <div class="flex border-b-3 border-blue-600 p-4 bg-blue-50">
            <div class="w-1 h-full bg-yellow-400 rounded-none mr-3"></div>
            <div class="flex-1">
              <div class="flex items-center justify-between">
                <div class="flex items-center">
                  <div class="bg-blue-600 text-yellow-400 w-7 h-7 rounded-none flex items-center justify-center mr-2 font-black">
                    1</div>
                  <h3 class="font-black text-blue-600 hover:text-blue-800 cursor-pointer" onclick="toggleExpand(1)">
                    更新I项目系统</h3>
                </div>
                <div class="flex items-center space-x-2">
                  <button
                    class="w-6 h-6 rounded-none border-2 border-blue-600 flex items-center justify-center toggle-button bg-blue-600 text-yellow-400 font-black"
                    onclick="toggleStatus(1)">
                    <iconify-icon class="hidden text-white" icon="mdi:check"></iconify-icon>
                  </button>
                  <button
                    class="text-sm bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-1 rounded flex items-center"
                    onclick="openPermissionModal(1, '更新I项目系统', '更新项目管理系统至最新版本，包括数据库迁移和接口配置')">
                    <iconify-icon class="mr-1" icon="mdi:upload"></iconify-icon>上传
                  </button>
                </div>
              </div>
            </div>
          </div>
          <div class="hidden expanded-content" id="expand-1">
            <div class="px-4 py-3 text-gray-600 text-sm">
              <p>更新项目管理系统至最新版本，包括数据库迁移和接口配置</p>
              <div class="mt-4 flex items-center justify-between">
                <span class="text-xs text-gray-500">最后更新: 2025-11-18</span>
                <span class="px-2 py-1 bg-yellow-100 text-yellow-800 rounded text-xs">待处理</span>
              </div>
            </div>
          </div>
        </div>
        <!-- SOP项目卡片 2 -->
        <div class="bg-white rounded-xl shadow-md overflow-hidden card-transition">
          <div class="flex border-b border-gray-100 p-4">
            <div class="w-1 h-full bg-blue-500 rounded mr-3"></div>
            <div class="flex-1">
              <div class="flex items-center justify-between">
                <div class="flex items-center">
                  <div class="bg-indigo-100 text-indigo-700 w-7 h-7 rounded-full flex items-center justify-center mr-2">
                    2</div>
                  <h3 class="font-medium text-gray-900 hover:text-indigo-700 cursor-pointer" onclick="toggleExpand(2)">
                    更新慧人天系统</h3>
                </div>
                <div class="flex items-center space-x-2">
                  <button
                    class="w-6 h-6 rounded-full border-2 border-gray-300 flex items-center justify-center toggle-button"
                    onclick="toggleStatus(2)">
                    <iconify-icon class="hidden text-white" icon="mdi:check"></iconify-icon>
                  </button>
                  <button
                    class="text-sm bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-1 rounded flex items-center"
                    onclick="openPermissionModal(2, '更新慧人天系统', '人力资源系统配置更新，包括员工权限调整和流程优化')">
                    <iconify-icon class="mr-1" icon="mdi:upload"></iconify-icon>上传
                  </button>
                </div>
              </div>
            </div>
          </div>
          <div class="hidden expanded-content" id="expand-2">
            <div class="px-4 py-3 text-gray-600 text-sm">
              <p>人力资源系统配置更新，包括员工权限调整和流程优化</p>
              <div class="mt-4 flex items-center justify-between">
                <span class="text-xs text-gray-500">最后更新: 2025-11-20</span>
                <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs">进行中</span>
              </div>
            </div>
          </div>
        </div>
        <!-- SOP项目卡片 3 -->
        <div class="bg-white rounded-xl shadow-md overflow-hidden card-transition">
          <div class="flex border-b border-gray-100 p-4">
            <div class="w-1 h-full bg-green-500 rounded mr-3"></div>
            <div class="flex-1">
              <div class="flex items-center justify-between">
                <div class="flex items-center">
                  <div class="bg-indigo-100 text-indigo-700 w-7 h-7 rounded-full flex items-center justify-center mr-2">
                    3</div>
                  <h3 class="font-medium text-gray-900 hover:text-indigo-700 cursor-pointer" onclick="toggleExpand(3)">
                    更新分贝通系统</h3>
                </div>
                <div class="flex items-center space-x-2">
                  <button
                    class="w-6 h-6 rounded-full border-2 border-gray-300 flex items-center justify-center toggle-button"
                    onclick="toggleStatus(3)">
                    <iconify-icon class="hidden text-white" icon="mdi:check"></iconify-icon>
                  </button>
                  <button
                    class="text-sm bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-1 rounded flex items-center"
                    onclick="openPermissionModal(3, '更新分贝通系统', '费用管理系统升级，集成新支付接口和审批流程')">
                    <iconify-icon class="mr-1" icon="mdi:upload"></iconify-icon>上传
                  </button>
                </div>
              </div>
            </div>
          </div>
          <div class="hidden expanded-content" id="expand-3">
            <div class="px-4 py-3 text-gray-600 text-sm">
              <p>费用管理系统升级，集成新支付接口和审批流程</p>
              <div class="mt-4 flex items-center justify-between">
                <span class="text-xs text-gray-500">最后更新: 2025-11-22</span>
                <span class="px-2 py-1 bg-green-100 text-green-800 rounded text-xs">已完成</span>
              </div>
            </div>
          </div>
        </div>
        <!-- SOP项目卡片 4 -->
        <div class="bg-white rounded-xl shadow-md overflow-hidden card-transition">
          <div class="flex border-b border-gray-100 p-4">
            <div class="w-1 h-full bg-yellow-500 rounded mr-3"></div>
            <div class="flex-1">
              <div class="flex items-center justify-between">
                <div class="flex items-center">
                  <div class="bg-indigo-100 text-indigo-700 w-7 h-7 rounded-full flex items-center justify-center mr-2">
                    4</div>
                  <h3 class="font-medium text-gray-900 hover:text-indigo-700 cursor-pointer" onclick="toggleExpand(4)">
                    修改企业微信群名与转接群主</h3>
                </div>
                <div class="flex items-center space-x-2">
                  <button
                    class="w-6 h-6 rounded-full border-2 border-gray-300 flex items-center justify-center toggle-button"
                    onclick="toggleStatus(4)">
                    <iconify-icon class="hidden text-white" icon="mdi:check"></iconify-icon>
                  </button>
                  <button
                    class="text-sm bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-1 rounded flex items-center"
                    onclick="openPermissionModal(4, '修改企业微信群名与转接群主', '更新企业微信群名称和负责人，确保组织架构变更同步')">
                    <iconify-icon class="mr-1" icon="mdi:upload"></iconify-icon>上传
                  </button>
                </div>
              </div>
            </div>
          </div>
          <div class="hidden expanded-content" id="expand-4">
            <div class="px-4 py-3 text-gray-600 text-sm">
              <p>更新企业微信群名称和负责人，确保组织架构变更同步</p>
              <div class="mt-4 flex items-center justify-between">
                <span class="text-xs text-gray-500">最后更新: 2025-11-23</span>
                <span class="px-2 py-1 bg-yellow-100 text-yellow-800 rounded text-xs">待处理</span>
              </div>
            </div>
          </div>
        </div>
        <!-- SOP项目卡片 5 -->
        <div class="bg-white rounded-xl shadow-md overflow-hidden card-transition">
          <div class="flex border-b border-gray-100 p-4">
            <div class="w-1 h-full bg-blue-500 rounded mr-3"></div>
            <div class="flex-1">
              <div class="flex items-center justify-between">
                <div class="flex items-center">
                  <div class="bg-indigo-100 text-indigo-700 w-7 h-7 rounded-full flex items-center justify-center mr-2">
                    5</div>
                  <h3 class="font-medium text-gray-900 hover:text-indigo-700 cursor-pointer" onclick="toggleExpand(5)">
                    更新周报总表</h3>
                </div>
                <div class="flex items-center space-x-2">
                  <button
                    class="w-6 h-6 rounded-full border-2 border-gray-300 flex items-center justify-center toggle-button"
                    onclick="toggleStatus(5)">
                    <iconify-icon class="hidden text-white" icon="mdi:check"></iconify-icon>
                  </button>
                  <button
                    class="text-sm bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-1 rounded flex items-center"
                    onclick="openPermissionModal(5, '更新周报总表', '同步本周项目进展和关键指标到共享周报总表')">
                    <iconify-icon class="mr-1" icon="mdi:upload"></iconify-icon>上传
                  </button>
                </div>
              </div>
            </div>
          </div>
          <div class="hidden expanded-content" id="expand-5">
            <div class="px-4 py-3 text-gray-600 text-sm">
              <p>同步本周项目进展和关键指标到共享周报总表</p>
              <div class="mt-4 flex items-center justify-between">
                <span class="text-xs text-gray-500">最后更新: 2025-11-24</span>
                <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs">进行中</span>
              </div>
            </div>
          </div>
        </div>
        <!-- SOP项目卡片 6 -->
        <div class="bg-white rounded-xl shadow-md overflow-hidden card-transition">
          <div class="flex border-b border-gray-100 p-4">
            <div class="w-1 h-full bg-red-500 rounded mr-3"></div>
            <div class="flex-1">
              <div class="flex items-center justify-between">
                <div class="flex items-center">
                  <div class="bg-indigo-100 text-indigo-700 w-7 h-7 rounded-full flex items-center justify-center mr-2">
                    6</div>
                  <h3 class="font-medium text-gray-900 hover:text-indigo-700 cursor-pointer" onclick="toggleExpand(6)">
                    更新财务跟踪总表</h3>
                </div>
                <div class="flex items-center space-x-2">
                  <button
                    class="w-6 h-6 rounded-full border-2 border-gray-300 flex items-center justify-center toggle-button"
                    onclick="toggleStatus(6)">
                    <iconify-icon class="hidden text-white" icon="mdi:check"></iconify-icon>
                  </button>
                  <button
                    class="text-sm bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-1 rounded flex items-center"
                    onclick="openPermissionModal(6, '更新财务跟踪总表', '财务预算与实际支出跟踪更新，整合多部门数据')">
                    <iconify-icon class="mr-1" icon="mdi:upload"></iconify-icon>上传
                  </button>
                </div>
              </div>
            </div>
          </div>
          <div class="hidden expanded-content" id="expand-6">
            <div class="px-4 py-3 text-gray-600 text-sm">
              <p>财务预算与实际支出跟踪更新，整合多部门数据</p>
              <div class="mt-4 flex items-center justify-between">
                <span class="text-xs text-gray-500">最后更新: 2025-11-21</span>
                <span class="px-2 py-1 bg-red-100 text-red-800 rounded text-xs">已中止</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>
  <!-- 上传模态框 -->
  <div class="fixed inset-0 bg-black bg-opacity-50 z-20 hidden items-center justify-center" id="uploadModal">
    <div class="bg-white rounded-xl shadow-xl w-96 p-6">
      <div class="flex justify-between items-center mb-4">
        <h3 class="font-semibold text-gray-900">上传变更文档</h3>
        <button class="text-gray-500 hover:text-gray-700" onclick="closeUploadModal()">
          <iconify-icon class="text-xl" icon="mdi:close"></iconify-icon>
        </button>
      </div>
      <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center mb-4">
        <iconify-icon class="text-4xl text-indigo-600 mb-2" icon="mdi:file-upload"></iconify-icon>
        <p class="text-gray-600 mb-2">拖放文件或点击上传</p>
        <p class="text-xs text-gray-500">支持PDF, DOCX, XLSX格式，最大5MB</p>
      </div>
      <div class="flex justify-between">
        <button class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50"
          onclick="closeUploadModal()">取消</button>
        <button class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">确认上传</button>
      </div>
    </div>
  </div>
  <!-- 同步变更窗口弹窗 -->
  <div class="fixed inset-0 bg-black bg-opacity-50 z-20 hidden items-center justify-center" id="syncChangesModal">
    <div class="bg-white rounded-xl shadow-xl w-4/5 max-w-5xl p-6 max-h-[90vh] flex flex-col">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-xl font-bold text-gray-900 flex items-center">
          <iconify-icon class="text-indigo-600 mr-2 text-2xl" icon="mdi:cloud-sync"></iconify-icon>
          同步变更窗口
        </h2>
        <button class="text-gray-500 hover:text-gray-700" onclick="closeSyncChangesModal()">
          <iconify-icon class="text-xl" icon="mdi:close"></iconify-icon>
        </button>
      </div>
      <div class="flex-1 overflow-y-auto max-h-[70vh] border border-gray-200 rounded-lg">
        <table class="w-full text-left">
          <thead class="bg-gray-50 sticky top-0">
            <tr>
              <th class="px-6 py-3 font-medium text-gray-500 text-sm border-b">文件名</th>
              <th class="px-6 py-3 font-medium text-gray-500 text-sm border-b">上传者</th>
              <th class="px-6 py-3 font-medium text-gray-500 text-sm border-b">上传时间</th>
              <th class="px-6 py-3 font-medium text-gray-500 text-sm border-b">关联项目</th>
              <th class="px-6 py-3 font-medium text-gray-500 text-sm border-b">文件大小</th>
              <th class="px-6 py-3 font-medium text-gray-500 text-sm border-b">操作</th>
            </tr>
          </thead>
          <tbody id="syncChangesList">
            <!-- 数据通过JS动态生成 -->
          </tbody>
        </table>
      </div>
      <div class="mt-6 flex justify-between items-center">
        <div class="text-sm text-gray-500">
          共 <span id="changesCount">0</span> 个变更记录
        </div>
        <div class="flex gap-2">
          <button class="px-4 py-2 border border-indigo-600 text-indigo-600 rounded-lg hover:bg-indigo-50">
            导出为报表
          </button>
          <button class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">
            清空记录
          </button>
        </div>
      </div>
    </div>
  </div>
  <!-- 权限申请弹窗 -->
  <div class="fixed inset-0 bg-black bg-opacity-50 z-20 hidden flex items-center justify-center" id="permissionModal">
    <div class="bg-white rounded-xl shadow-xl w-96 p-6 border border-gray-200">
      <div class="flex justify-between items-center mb-6">
        <h3 class="font-bold text-lg text-gray-900">权限申请表</h3>
        <button class="text-gray-500 hover:text-gray-700" onclick="closePermissionModal()">
          <iconify-icon class="text-xl" icon="mdi:close"></iconify-icon>
        </button>
      </div>
      <div class="space-y-4 max-h-96 overflow-y-auto">
        <!-- 申请人信息 -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">申请人</label>
          <div class="bg-gray-50 border border-gray-300 rounded-lg px-3 py-2.5">
            <p class="text-gray-900">管理员</p>
            <p class="text-xs text-gray-600">技术部</p>
          </div>
        </div>
        <!-- 申请原因 -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">申请原因 <span class="text-red-500">*</span></label>
          <textarea
            class="w-full px-3 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm resize-none"
            id="applyReason" maxlength="500" minlength="50" placeholder="请输入申请原因（至少50字）" rows="3"></textarea>
          <p class="text-xs text-gray-500 mt-1"><span id="charCount">0</span>/500 字</p>
        </div>
        <!-- 申请时间 -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">申请时间 <span class="text-red-500">*</span></label>
          <input
            class="w-full px-3 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"
            id="applyDateTime" type="datetime-local">
          </input>
        </div>
        <!-- 权限说明 -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">权限说明</label>
          <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
            <p class="text-sm text-gray-700" id="permissionDesc">权限描述加载中...</p>
          </div>
        </div>
        <!-- 状态显示 -->
        <div class="hidden bg-yellow-50 border border-yellow-200 rounded-lg p-3" id="statusDisplay">
          <div class="flex items-center justify-between mb-2">
            <span class="text-sm font-medium text-gray-700">申请状态</span>
            <span class="px-3 py-1 bg-yellow-100 text-yellow-800 rounded text-xs font-medium"
              id="statusBadge">待处理</span>
          </div>
          <p class="text-xs text-gray-600" id="statusTime">提交时间: 2025-11-24</p>
        </div>
      </div>
      <!-- 底部按钮 -->
      <div class="flex gap-3 mt-6">
        <button
          class="flex-1 px-4 py-2.5 border border-blue-600 text-blue-600 rounded-lg hover:bg-blue-50 font-medium text-sm"
          onclick="closePermissionModal()">取消</button>
        <button class="flex-1 px-4 py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium text-sm"
          onclick="submitPermissionRequest()">提交申请</button>
      </div>
    </div>
  </div>
  <script>
    // 卡片展开/收起功能
    function toggleExpand(id) {
      const expandContent = document.getElementById(`expand-${id}`);
      expandContent.classList.toggle('hidden');
      expandContent.classList.toggle('card-expand');
    }

    // 状态切换功能
    function toggleStatus(id) {
      const button = document.querySelectorAll('.toggle-button')[id - 1];
      const icon = button.querySelector('iconify-icon');
      const statusBar = button.closest('.card-transition').querySelector('.w-1');

      button.classList.toggle('bg-indigo-600');
      button.classList.toggle('border-indigo-600');
      icon.classList.toggle('hidden');

      if (button.classList.contains('bg-indigo-600')) {
        statusBar.classList.remove('bg-yellow-500', 'bg-blue-500', 'bg-red-500');
        statusBar.classList.add('bg-green-500');
      } else {
        statusBar.classList.remove('bg-green-500');
        statusBar.classList.add('bg-yellow-500');
      }
    }

    // 上传模态框控制
    let currentCardId = 0;

    function openUploadModal(id) {
      currentCardId = id;
      document.getElementById('uploadModal').classList.remove('hidden');
      document.getElementById('uploadModal').classList.add('flex');
    }

    function closeUploadModal() {
      document.getElementById('uploadModal').classList.add('hidden');
      document.getElementById('uploadModal').classList.remove('flex');
    }

    // 同步变更窗口控制
    function openSyncChangesModal() {
      // 生成示例的变更记录数据
      const changeRecords = [
        { id: 1, filename: '系统升级方案.pdf', uploader: '张工', uploadTime: '2025-11-23 14:35', project: 'I项目系统', size: '2.4MB' },
        { id: 2, filename: '数据迁移计划.xlsx', uploader: '李技术', uploadTime: '2025-11-22 10:20', project: '分贝通系统', size: '1.2MB' },
        { id: 3, filename: '权限配置更新.doc', uploader: '王经理', uploadTime: '2025-11-21 16:45', project: '慧人天系统', size: '0.8MB' },
        { id: 4, filename: '群主交接确认.png', uploader: '管理员', uploadTime: '2025-11-20 09:15', project: '企业微信群', size: '0.5MB' },
        { id: 5, filename: '周报格式调整.docx', uploader: '助理', uploadTime: '2025-11-19 13:30', project: '周报总表', size: '0.7MB' },
        { id: 6, filename: '财务预算模板.xlsx', uploader: '财务部', uploadTime: '2025-11-18 11:05', project: '财务跟踪表', size: '1.1MB' },
        { id: 7, filename: '变更审核记录.pdf', uploader: '质量组', uploadTime: '2025-11-17 15:40', project: 'I项目系统', size: '1.8MB' }
      ];

      // 渲染变更记录列表
      const listEl = document.getElementById('syncChangesList');
      listEl.innerHTML = '';

      changeRecords.forEach(record => {
        const tr = document.createElement('tr');
        tr.className = 'hover:bg-gray-50';
        tr.innerHTML = `
          <td class="px-6 py-4 border-b">
            <div class="flex items-center">
              <iconify-icon icon="mdi:file-document" class="text-blue-500 text-xl mr-3"></iconify-icon>
              ${record.filename}
            </div>
          </td>
          <td class="px-6 py-4 border-b">
            <div class="flex items-center">
              <div class="bg-gray-200 border-2 border-dashed rounded-full w-7 h-7 mr-2"></div>
              ${record.uploader}
            </div>
          </td>
          <td class="px-6 py-4 border-b text-gray-600 text-sm">${record.uploadTime}</td>
          <td class="px-6 py-4 border-b">
            <span class="px-2 py-1 bg-indigo-100 text-indigo-700 rounded text-xs">${record.project}</span>
          </td>
          <td class="px-6 py-4 border-b text-gray-500 text-sm">${record.size}</td>
          <td class="px-6 py-4 border-b">
            <button class="text-indigo-600 hover:text-indigo-800" onclick="downloadFile(${record.id})">
              <iconify-icon icon="mdi:download" class="text-lg"></iconify-icon>
            </button>
          </td>
        `;
        listEl.appendChild(tr);
      });

      // 更新总数
      document.getElementById('changesCount').textContent = changeRecords.length;

      // 显示模态框
      document.getElementById('syncChangesModal').classList.remove('hidden');
      document.getElementById('syncChangesModal').classList.add('flex');
    }

    function closeSyncChangesModal() {
      document.getElementById('syncChangesModal').classList.add('hidden');
      document.getElementById('syncChangesModal').classList.remove('flex');
    }

    // 权限申请弹窗控制
    let permissionRequests = {};
    let currentPermissionRequest = null;

    function openPermissionModal(id, title, description) {
      currentPermissionRequest = {
        id: id,
        title: title,
        description: description,
        status: 'draft'
      };

      // 设置权限说明
      document.getElementById('permissionDesc').textContent = description;

      // 设置默认时间为当前时间
      const now = new Date();
      now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
      document.getElementById('applyDateTime').value = now.toISOString().slice(0, 16);

      // 清空申请原因
      document.getElementById('applyReason').value = '';
      document.getElementById('charCount').textContent = '0';

      // 隐藏状态显示
      document.getElementById('statusDisplay').classList.add('hidden');

      document.getElementById('permissionModal').classList.remove('hidden');
      document.getElementById('permissionModal').classList.add('flex');
    }

    function closePermissionModal() {
      currentPermissionRequest = null;
      document.getElementById('permissionModal').classList.add('hidden');
      document.getElementById('permissionModal').classList.remove('flex');
    }

    function submitPermissionRequest() {
      const reason = document.getElementById('applyReason').value.trim();
      const dateTime = document.getElementById('applyDateTime').value;

      if (!reason || reason.length < 50) {
        alert('请输入至少50个字的申请原因');
        return;
      }

      if (!dateTime) {
        alert('请选择申请时间');
        return;
      }

      // 保存申请信息
      permissionRequests[currentPermissionRequest.id] = {
        ...currentPermissionRequest,
        reason: reason,
        dateTime: dateTime,
        status: 'pending',
        submitTime: new Date().toLocaleString('zh-CN')
      };

      // 显示待审批状态
      document.getElementById('statusDisplay').classList.remove('hidden');
      document.getElementById('statusBadge').textContent = '等待审批';
      document.getElementById('statusBadge').className = 'px-3 py-1 bg-blue-100 text-blue-800 rounded text-xs font-medium';
      document.getElementById('statusTime').textContent = '提交时间: ' + new Date().toLocaleString('zh-CN');

      // 禁用表单输入
      document.getElementById('applyReason').disabled = true;
      document.getElementById('applyDateTime').disabled = true;
      document.querySelectorAll('#permissionModal button').forEach(btn => {
        if (btn.textContent.includes('提交申请')) {
          btn.disabled = true;
          btn.classList.add('opacity-50', 'cursor-not-allowed');
        }
      });

      setTimeout(() => {
        alert('权限申请已提交，等待审批中...');
      }, 300);
    }

    // 字数统计
    document.addEventListener('DOMContentLoaded', () => {
      const reasonTextarea = document.getElementById('applyReason');
      if (reasonTextarea) {
        reasonTextarea.addEventListener('input', () => {
          document.getElementById('charCount').textContent = reasonTextarea.value.length;
        });
      }

      // 设置已完成状态的卡片
      toggleStatus(3);
    });

    // 下载文件函数
    function downloadFile(id) {
      alert(`正在下载文件(ID: ${id})...`);
    }
  </script>
</body>

</html>